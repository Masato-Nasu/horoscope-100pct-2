<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>100% æ˜Ÿå ã„ 2</title>
<meta name="theme-color" content="#060812">
<meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="/horoscope-100pct-2/icon-180.png">
<link rel="manifest" href="/horoscope-100pct-2/manifest.json">

<!-- v52.1 -->
<link rel="icon" href="/horoscope-100pct-2/favicon.svg" type="image/svg+xml">
<link rel="preload" href="/horoscope-100pct-2/splash.css" as="style">
<link rel="stylesheet" href="/horoscope-100pct-2/splash.css">
<script defer src="/horoscope-100pct-2/splash.js"></script>

<style>
body{font-family:'Noto Sans JP',system-ui,-apple-system,sans-serif;background:#fafafa;color:#222;margin:0;text-align:center}
header{background:#6b46c1;color:#fff;padding:1.2em 0;font-weight:700;font-size:1.3em}
main{padding:1.2em;max-width:720px;margin:0 auto}
input,button{font:inherit;padding:.6em;border-radius:.6em;border:1px solid #ccc;box-sizing:border-box;width:100%}
button{background:#6b46c1;color:#fff;border:none;cursor:pointer} button:hover{opacity:.9}
.card{background:#fff;border-radius:1em;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:1.1em;margin-top:1em;text-align:left}
.muted{color:#666;font-size:.9em}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 16px;border-radius:999px;opacity:0;transition:opacity .25s}
.toast.show{opacity:1}
#outputArea button{margin-top:12px} #outputArea button+button{margin-top:12px}
.card .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between}
.card .title{font-weight:700}
.score{display:flex;align-items:center;gap:8px;min-width:180px;margin-left:auto}
.bar{position:relative;flex:1;height:8px;background:#eee;border-radius:999px;overflow:hidden}
.bar-fill{position:absolute;inset:0 100% 0 0;background:#6b46c1;border-radius:999px;transition:width .6s ease}
.pct{font-weight:700;color:#4a3ba5;min-width:3ch;text-align:right}
.card.birthday{border:2px solid #f5b5d5}
#confettiCanvas{position:fixed;inset:0;pointer-events:none;z-index:9999}
</style>
</head>
<body>
<!-- Splash overlay (v49) -->
<div id="app-splash" role="status" aria-live="polite">
  <img class="logo" src="/horoscope-100pct-2/icon-192.png" alt="">
  <div class="title">100% æ˜Ÿå ã„ 2</div>
  <div class="sub">Startingâ€¦</div>
</div>

<header>100% æ˜Ÿå ã„ 2</header>
<main>
<section id="inputArea">
  <h2>ã‚ãªãŸã®æƒ…å ±ã‚’å…¥åŠ›</h2>
  <label>ç”Ÿå¹´æœˆæ—¥</label><input type="date" id="birthDate"><br><br>
  <label>å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label><input type="time" id="birthTime" step="60"><br><br>
  <label>å ã„ãŸã„æ—¥ï¼ˆçœç•¥å¯ï¼‰</label><input type="date" id="targetDate"><br><br>
  <label>å‡ºç”Ÿéƒ½å¸‚å</label><input type="text" id="placeName" placeholder="Tokyo"><br><br>
  <button id="geoBtn" type="button">éƒ½å¸‚åã‹ã‚‰å–å¾—</button><br><br>
  <label>ç·¯åº¦</label><input type="text" id="lat" placeholder="35.6895"><br><br>
  <label>çµŒåº¦</label><input type="text" id="lon" placeholder="139.6917"><br><br>
  <button id="runBtn" type="button">çµæœã‚’è¦‹ã‚‹</button>
</section>

<section id="outputArea" style="display:none;">
  <h2>çµæœ</h2>
  <div id="resultContainer"></div>
  <button id="saveBtn" type="button">JPEGä¿å­˜</button>
  <button id="backBtn" type="button">æˆ»ã‚‹</button>
</section>
</main>

<canvas id="confettiCanvas" style="display:none;"></canvas>
<div class="toast" id="toast"></div>

<script>
const $=id=>document.getElementById(id);
function toast(m){const t=$('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400);}
function escapeHtml(s){return String(s).replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));}
function saveInputs(){const d={birthDate:$('birthDate').value||'',birthTime:$('birthTime').value||'',targetDate:$('targetDate').value||'',placeName:$('placeName').value||'',lat:$('lat').value||'',lon:$('lon').value||''}; localStorage.setItem('horo.inputs',JSON.stringify(d));}
function loadInputs(){try{const d=JSON.parse(localStorage.getItem('horo.inputs')||'{}'); for(const k in d){if($(k)) $(k).value=d[k];}}catch{}}
function seasonToneByMonth(m){if([12,1,2].includes(m))return'é™ã‹ãªå†¬ã€è¶³å…ƒã‚’å›ºã‚ã‚‹ã¨ã'; if([3,4,5].includes(m))return'èŠ½å¹ãæ˜¥ã€å‹•ãå‡ºã—ã«è¿½ã„é¢¨'; if([6,7,8].includes(m))return'è¼ãå¤ã€å‹¢ã„ã¨ç™ºä¿¡ãŒåŠ¹ã'; if([9,10,11].includes(m))return'å®Ÿã‚Šã®ç§‹ã€ä»•ä¸Šã’ã¨æ•´ãˆãŒå‰'; return'å­£ç¯€ã®ãƒªã‚ºãƒ ã«ä¹—ã‚‹ã¨è‰¯ã„æ—¥';}

function snapToPresetIfAlias(q){ if(!q) return null; const s=String(q).toLowerCase().trim(); if(['tokyo','tokyo japan','æ±äº¬','ã¨ã†ãã‚‡ã†'].includes(s)) return {lat:'35.6895',lon:'139.6917'}; return null; }
function haversine(a,b,c,d){const R=6371,toRad=x=>x*Math.PI/180; const dLat=toRad(c-a), dLon=toRad(d-b); const A=Math.sin(dLat/2)**2+Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLon/2)**2; return 2*R*Math.asin(Math.sqrt(A));}
function snapNearPreset(lat,lon,km=15){const tLat=35.6895,tLon=139.6917; const dist=haversine(+lat,+lon,tLat,tLon); if(dist<=km) return {lat:String(tLat),lon:String(tLon)}; return null;}

const GNEWS_API_KEY="0e21cddc975f5f620c1431fde88db5fe";
async function fetchNewsTopJP(){
  try{
    const url=`https://gnews.io/api/v4/top-headlines?lang=ja&country=jp&max=3&category=general&apikey=${GNEWS_API_KEY}`;
    const r=await fetch(url,{headers:{'Accept':'application/json'},cache:'no-store'});
    if(!r.ok) throw new Error('GNews HTTP '+r.status);
    const j=await r.json();
    const t=(j?.articles||[]).map(a=>a?.title).filter(Boolean).slice(0,2);
    if(t.length) return t;
  }catch(e){}
  try{
    const rss='https://www3.nhk.or.jp/rss/news/cat0.xml';
    const r=await fetch(rss,{cache:'no-store'}); if(!r.ok) throw new Error('NHK RSS HTTP '+r.status);
    const x=await r.text(); const doc=new DOMParser().parseFromString(x,'application/xml');
    return Array.from(doc.querySelectorAll('item>title')).map(n=>(n.textContent||'').trim()).filter(Boolean).slice(0,2);
  }catch(e){return []}
}

const d2r=d=>d*Math.PI/180, norm360=d=>((d%360)+360)%360;
function toJD(date){ return date.getTime()/86400000 + 2440587.5; }
function sunLongitudeDeg(jd){
  const T=(jd-2451545.0)/36525;
  const L0=norm360(280.46646+36000.76983*T+0.0003032*T*T);
  const M =norm360(357.52911+35999.05029*T-0.0001537*T*T);
  const Mr=d2r(M);
  const C =(1.914602-0.004817*T-0.000014*T*T)*Math.sin(Mr)
         +(0.019993-0.000101*T)*Math.sin(2*Mr)
         +0.000289*Math.sin(3*Mr);
  return norm360(L0+C);
}
function moonLongitudeDeg(jd){
  const T=(jd-2451545.0)/36525;
  const Lp=norm360(218.3164477+481267.88123421*T-0.0015786*T*T+T*T*T/538841 - T*T*T*T/65194000);
  const D =norm360(297.8501921+445267.1114034*T -0.0018819*T*T+T*T*T/545868 - T*T*T*T/113065000);
  const M =norm360(357.5291092+35999.0502909*T -0.0001536*T*T+T*T*T/24490000);
  const Mp=norm360(134.9633964+477198.8675055*T +0.0087414*T*T+T*T*T/69699  - T*T*T*T/14712000);
  const Dr=d2r(D), Mr=d2r(M), Mpr=d2r(Mp);
  let lon=Lp
    +6.289*Math.sin(Mpr)
    +1.274*Math.sin(2*Dr - Mpr)
    +0.658*Math.sin(2*Dr)
    +0.214*Math.sin(2*Mpr)
    +0.110*Math.sin(Dr)
    -0.186*Math.sin(Mr)
    -0.059*Math.sin(2*Dr - 2*Mpr)
    -0.057*Math.sin(2*Dr - Mr - Mpr)
    +0.053*Math.sin(2*Dr + Mpr)
    +0.046*Math.sin(2*Dr - Mr)
    +0.041*Math.sin(M - Mp);
  return norm360(lon);
}
function sunMoonElongationDeg(date){ const jd=toJD(date); return norm360(moonLongitudeDeg(jd)-sunLongitudeDeg(jd)); }
function aspectName(a){a=((a%360)+360)%360; const eps=15;
  if(Math.abs(a-0)<=eps||Math.abs(a-360)<=eps)return'æ–°æœˆä»˜è¿‘';
  if(Math.abs(a-90)<=eps)return'ä¸Šå¼¦ä»˜è¿‘';
  if(Math.abs(a-180)<=eps)return'æº€æœˆä»˜è¿‘';
  if(Math.abs(a-270)<=eps)return'ä¸‹å¼¦ä»˜è¿‘';
  if(a<90)return'æˆé•·ã®ç›¸'; if(a<180)return'ç†Ÿæˆã®ç›¸'; if(a<270)return'åç©«ã®ç›¸'; return'å†…çœã®ç›¸';
}

// ===== Angle-Only Hardcore Engine (Multi-Planet) v3-5 =====
const ASPECTS = [
  { name:"Conjunction",   angle:  0, orb: 8,   impact: +0.60 },
  { name:"Semi-sextile",  angle: 30, orb: 2,   impact: +0.20 },
  { name:"Decile",        angle: 36, orb: 1.5, impact: +0.15 },
  { name:"Semi-square",   angle: 45, orb: 3,   impact: -0.30 },
  { name:"Sextile",       angle: 60, orb: 4,   impact: +0.45 },
  { name:"Quintile",      angle: 72, orb: 2.5, impact: +0.35 },
  { name:"Square",        angle: 90, orb: 6,   impact: -0.60 },
  { name:"Tri-decile",    angle:108, orb: 2.5, impact: +0.25 },
  { name:"Trine",         angle:120, orb: 6,   impact: +0.70 },
  { name:"Sesqui-square", angle:135, orb: 3.5, impact: -0.40 },
  { name:"Bi-quintile",   angle:144, orb: 2.5, impact: +0.30 },
  { name:"Quincunx",      angle:150, orb: 3.5, impact: -0.20 },
  { name:"Opposition",    angle:180, orb: 8,   impact: -0.70 }
];

function normalizeAngleDiff(lon1Deg, lon2Deg){
  let diff = Math.abs(lon1Deg - lon2Deg) % 360;
  if (diff > 180) diff = 360 - diff;
  return diff;
}

function aspectWeight(angleDeg, aspectAngle, orbDeg){
  const diff = Math.abs(angleDeg - aspectAngle);
  if (diff > orbDeg) return 0;
  const x = diff / orbDeg;
  return 1 - x * x;
}

function computeAspectPowerForAngle(angleDeg){
  let sum = 0, total = 0;
  for (const asp of ASPECTS){
    const w = aspectWeight(angleDeg, asp.angle, asp.orb);
    if (w <= 0) continue;
    sum   += asp.impact * w;
    total += Math.abs(asp.impact) * w;
  }
  if (!total) return 0;
  return sum / total;
}

function computeAngleOnlyScore(planets){
  const n = planets.length;
  if (n < 2) return { score:50, harmonyScore:0, tensionScore:0, globalPower:0 };

  let allSum=0, allW=0, posSum=0, posW=0, negSum=0, negW=0;
  for (let i=0;i<n;i++){
    for (let j=i+1;j<n;j++){
      const p1 = planets[i], p2 = planets[j];
      const ang = normalizeAngleDiff(p1.lonDeg, p2.lonDeg);
      const power = computeAspectPowerForAngle(ang);
      const w = p1.weight * p2.weight;
      const contrib = power * w;
      allSum += contrib; allW += w;
      if (power > 0){ posSum += power*w; posW += w; }
      else if (power < 0){ negSum += (-power)*w; negW += w; }
    }
  }

  const globalPower = allW ? allSum / allW : 0;
  const harmonyIdx  = posW ?  posSum / posW : 0;
  const tensionIdx  = negW ?  negSum / negW : 0;

  const CENTER = 50, SPREAD = 45;
  let score = Math.round(CENTER + globalPower * SPREAD);
  score = Math.max(0, Math.min(100, score));

  return {
    score,
    harmonyScore: Math.round(harmonyIdx*100),
    tensionScore: Math.round(tensionIdx*100),
    globalPower
  };
}

// Low-precision ecliptic longitudes for inner planets (Mercury~Saturn)
// Based on simple orbital elements;ååˆ†"å ã„ç”¨é€”"ãƒ¬ãƒ™ãƒ«ã®è¿‘ä¼¼ã€‚
function planetLongitudeDeg(jd, name){
  const d = jd - 2451545.0;
  const rad = Math.PI / 180;
  function norm(x){ x%=360; if (x<0) x+=360; return x; }
  function kepler(Mdeg, e){
    let M = Mdeg * rad;
    let E = M;
    for (let k=0;k<6;k++){
      E = E - (E - e*Math.sin(E) - M)/(1 - e*Math.cos(E));
    }
    return E;
  }

  let N,i,w,a,e,M;
  switch(name){
    case "Mercury":
      N = 48.3313 + 3.24587E-5*d;  i = 7.0047 + 5.00E-8*d;  w = 29.1241 + 1.01444E-5*d;
      a = 0.387098; e = 0.205635 + 5.59E-10*d; M = 168.6562 + 4.0923344368*d; break;
    case "Venus":
      N = 76.6799 + 2.46590E-5*d;  i = 3.3946 + 2.75E-8*d;  w = 54.8910 + 1.38374E-5*d;
      a = 0.723330; e = 0.006773 - 1.302E-9*d; M = 48.0052 + 1.6021302244*d; break;
    case "Mars":
      N = 49.5574 + 2.11081E-5*d;  i = 1.8497 - 1.78E-8*d;   w = 286.5016 + 2.92961E-5*d;
      a = 1.523688; e = 0.093405 + 2.516E-9*d; M = 18.6021 + 0.5240207766*d; break;
    case "Jupiter":
      N = 100.4542 + 2.76854E-5*d; i = 1.3030 - 1.557E-7*d;  w = 273.8777 + 1.64505E-5*d;
      a = 5.20256; e = 0.048498 + 4.469E-9*d; M = 19.8950 + 0.0830853001*d; break;
    case "Saturn":
      N = 113.6634 + 2.38980E-5*d; i = 2.4886 - 1.081E-7*d;  w = 339.3939 + 2.97661E-5*d;
      a = 9.55475; e = 0.055546 - 9.499E-9*d; M = 316.9670 + 0.0334442282*d; break;
    default:
      return 0;
  }

  N = norm(N); i = norm(i); w = norm(w); M = norm(M);
  const E = kepler(M, e);
  const xv = a*(Math.cos(E) - e);
  const yv = a*(Math.sqrt(1-e*e)*Math.sin(E));
  const v  = Math.atan2(yv, xv) / rad;
  const r  = Math.sqrt(xv*xv + yv*yv);
  const lon = Math.atan2(
    Math.sin((N*rad)) * Math.cos((v+w)*rad) + Math.cos((N*rad)) * Math.sin((v+w)*rad) * Math.cos(i*rad),
    Math.cos((N*rad)) * Math.cos((v+w)*rad) - Math.sin((N*rad)) * Math.sin((v+w)*rad) * Math.cos(i*rad)
  ) / rad;

  return norm(lon);
}

async function fetchNewsAndSeasonContext(dateStr){
  const d=new Date(dateStr+'T12:00:00');
  const bt=$('birthTime')?.value||'00:00'; const [hh,mm]=(bt||'00:00').split(':').map(v=>parseInt(v||'0',10));
  d.setMinutes(d.getMinutes()+hh*60+mm - 12*60);
  const season=seasonToneByMonth(d.getMonth()+1);
  const ang=sunMoonElongationDeg(d);
  const star=`â˜† æ˜Ÿã®è§’åº¦ï¼šå¤ªé™½-æœˆ â‰ˆ ${Math.round(ang)}Â°ï¼ˆ${aspectName(ang)}ï¼‰`;
  const news=await fetchNewsTopJP();
  let line=`ä»Šæ—¥ã®ç©ºæ°—æ„Ÿï¼š${season}ã€‚<br><span class="muted">${star}</span>`;
  if(news.length){ const safe=news.map(s=>s.replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))); line+=`<br><span class="muted">ğŸ—ï¸ æœ€è¿‘ã®è©±é¡Œï¼š${safe.join(' ï¼ ')}ã€‚</span>`; }
  return line;
}

function circDist(a,b){ return Math.abs(((a-b)%360+540)%360-180); }
function angleBaseScore(angle){
  const good=[60,120,240,300], bad=[0,180,270];
  const dg = Math.min(...good.map(a=>circDist(angle,a)));
  const db = Math.min(...bad .map(a=>circDist(angle,a)));
  const gAff = Math.max(0, 1 - dg/40);
  const bAff = Math.max(0, 1 - db/22);
  const raw = 0.8*gAff - 1.0*bAff;
  const k = 2.2;
  const logistic = 1/(1+Math.exp(-k*raw));
  let score = Math.round(50 + 35*(logistic-0.5)*2);
  score = Math.max(5, Math.min(95, score));
  return score;
}
const TOPIC_TWEAK={'å…¨ä½“é‹':0,'æ‹æ„›':3,'ä»•äº‹':0,'é‡‘é‹':-2,'å¥åº·':1};

function stableSeed(str){ let h=0; for(let i=0;i<str.length;i++){ h=(Math.imul(31,h) + str.charCodeAt(i))|0; } return (h>>>0); }
function makeRng(seed){ let t=seed>>>0; return function(){ t|=0; t=(t+0x6D2B79F5)|0; let r=Math.imul(t ^ (t>>>15), 1|t); r^=r + Math.imul(r ^ (r>>>7), 61|r); return ((r ^ (r>>>14))>>>0) / 4294967296; } }

const BANK={
  "å…¨ä½“é‹":{a:["æ—©ã‚ã®ç€æ‰‹ãŒ","è‚©ã®åŠ›ã‚’æŠœãã¨","ä¸€åº¦æ•´ãˆã¦ã‹ã‚‰","åŸç‚¹ã«æˆ»ã‚‹ã¨","å°ã•ãªä¸€æ­©ãŒ","ä¸å¯§ãªç¢ºèªãŒ","ç›´æ„Ÿã‚ˆã‚Šæ®µå–ã‚Šã§","ä¼šè©±ã®ä¸­ã«","æ•´ç†æ•´é “ãŒ","æ„Ÿè¬ã‚’è¡Œå‹•ã«","ä½™ç™½ã‚’ä½œã‚‹ã¨","ç¬‘é¡”ã§å§‹ã‚ã‚‹ã¨","æœã®ç©ºæ°—ãŒ","æ­©ãé€Ÿåº¦ã‚’è½ã¨ã™ã¨","ã„ã„é¦™ã‚ŠãŒ","é™ã‹ãªæ™‚é–“ãŒ","è¨˜éŒ²ã‚’æ®‹ã™ã¨","ä¸€äººæ™‚é–“ãŒ","èƒŒç­‹ã‚’ä¼¸ã°ã™ã¨","æ·±å‘¼å¸ãŒ"],
    b:["æµã‚Œã‚’å¤‰ãˆã‚‹ã€‚","é‹ã‚’å‘¼ã¶ã€‚","åˆ¤æ–­ã‚’åŠ©ã‘ã‚‹ã€‚","è¿·ã„ã‚’ã»ã©ãã€‚","åˆå¾Œã‚’æ”¯ãˆã‚‹ã€‚","å‘¨å›²ã«ä¼ã‚ã‚‹ã€‚","é€²ã¿ã‚„ã™ã„ã€‚","ãƒ’ãƒ³ãƒˆã‚’é‹ã¶ã€‚","é ­ã‚‚æ•´ã†ã€‚","å¥½å¾ªç’°ã‚’ç”Ÿã‚€ã€‚","ä½™è£•ã‚’æˆ»ã™ã€‚","ãƒ„ã‚­ã‚’é€£ã‚Œã¦ãã‚‹ã€‚","ãƒªã‚ºãƒ ã‚’æ•´ãˆã‚‹ã€‚","æ™¯è‰²ãŒè¦‹ãˆã‚‹ã€‚","æ°—åˆ†è»¢æ›ã«â—ã€‚","é›†ä¸­ã‚’ç”Ÿã‚€ã€‚","æ¬¡ã«ç¹‹ãŒã‚‹ã€‚","å¿ƒã‚’å®ˆã‚‹ã€‚","è¦–ç•ŒãŒåºƒãŒã‚‹ã€‚","è½ã¡ç€ãã‚’å–ã‚Šæˆ»ã™ã€‚"],
    c:["ç„¦ã‚‰ãšç¢ºå®Ÿã«ã€‚","ã¾ãšä¸€ã¤çµ‚ã‚ã‚‰ã›ã‚ˆã†ã€‚","ç¬‘é¡”ã‚’å¿˜ã‚Œãšã«ã€‚","çŸ­ããƒ¡ãƒ¢ã‚’ã€‚","æ·±å‘¼å¸ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€‚","ä»Šæ—¥ã§ãã‚‹åˆ†ã ã‘ã§ååˆ†ã€‚","ç„¡ç†ã«åºƒã’ãšä¸å¯§ã«ã€‚","äººã«é ¼ã£ã¦OKã€‚","ä½™è¨ˆãªæƒ…å ±ã¯æ‰‹æ”¾ã—ã¦ã€‚","æœã®ã†ã¡ã«è¦ä»¶ã‚’ã€‚","äºˆå®šã¯ä¸‰ã¤ã«çµã£ã¦ã€‚","æ‰‹é †ã‚’å…ˆã«æ±ºã‚ã‚‹ã¨â—ã€‚","éå»ã«æ„Ÿè¬ã—ã¦å‰ã¸ã€‚","ç›®ç·šã‚’ä¸Šã’ã¦æ­©ã“ã†ã€‚","ä¼‘æ†©ã‚‚äºˆå®šã«å…¥ã‚Œã¦ã€‚","å¿ƒåœ°ã‚ˆã•ã‚’é¸ã‚“ã§æ­£è§£ã€‚","å°ã•ãªé”æˆã‚’æ¥½ã—ã‚“ã§ã€‚","æ°´åˆ†ã‚’å¿˜ã‚Œãšã«ã€‚","é™ã‹ãªå ´æ‰€ã‚’é¸ã¼ã†ã€‚","ä»Šæ—¥ã¯â€œè¶³ã—ç®—ã‚ˆã‚Šæ•´é “â€ã€‚"]},
  "æ‹æ„›":{a:["æŒ¨æ‹¶ï¼‹ä¸€è¨€ãŒ","èãå½¹7å‰²ãŒ","ç›¸æ‰‹ã®äºˆå®šã‚’å…ˆã«èãã¨","ç´ ç›´ãªè¤’ã‚è¨€è‘‰ãŒ","èº«ã ã—ãªã¿ã‚’æ•´ãˆã‚‹ã¨","å°ã•ãªæ°—é£ã„ãŒ","ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒ","å…±é€šã®è©±é¡ŒãŒ","è·é›¢ã‚’åŠæ­©ã ã‘è©°ã‚ã‚‹ã¨","ç›®ã‚’è¦‹ã¦è©±ã™ã¨","ã‚ã‚ŠãŒã¨ã†ã®ä¸€è¨€ãŒ","ã‚†ã£ãã‚Šè©±ã™ã¨","èƒŒä¼¸ã³ã—ãªã„å§¿å‹¢ãŒ","å£°ã®ãƒˆãƒ¼ãƒ³ã‚’æŸ”ã‚‰ã‹ãã™ã‚‹ã¨","å†—è«‡ã‚ˆã‚Šèª å®Ÿã•ãŒ","è¿”ä¿¡ã¯çŸ­ãæ˜ã‚‹ããŒ","æ²ˆé»™ã‚’æã‚Œãªã„ã“ã¨ãŒ","ç›¸æ‰‹ã®å¤‰åŒ–ã«æ°—ã¥ãã¨","ç¬‘é¡”ã®å†™çœŸãŒ","æ‰‹æ›¸ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ"],
    b:["è·é›¢ã‚’ç¸®ã‚ã‚‹ã€‚","å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹ã€‚","èª¤è§£ã‚’æ¸›ã‚‰ã™ã€‚","å¥½å°è±¡ã«ã¤ãªãŒã‚‹ã€‚","æ°—æŒã¡ã‚’ä¼ãˆã‚‹ã€‚","ç©ºæ°—ã‚’å’Œã‚‰ã’ã‚‹ã€‚","ã™ã£ã¨å±Šãã€‚","çµ†ã‚’å¼·ã‚ã‚‹ã€‚","è‡ªç„¶ã«ä¼ã‚ã‚‹ã€‚","å£ã‚’ä½ãã™ã‚‹ã€‚","æœªæ¥ã®ãã£ã‹ã‘ã«ã€‚","å°è±¡ã‚’è‰¯ãã™ã‚‹ã€‚","è‡ªåˆ†ã‚‰ã—ã•ã‚’æ”¯ãˆã‚‹ã€‚","æƒ³ã„ã‚’å±Šã‘ã‚‹ã€‚","ä»Šæ—¥ã®æ­£è§£ã€‚","ã‚¹ãƒ ãƒ¼ã‚ºã€‚","å¿ƒåœ°ã‚ˆã„ã€‚","å¤§åˆ‡ãªã‚µã‚¤ãƒ³ã€‚","ãã£ã‹ã‘ã‚’ç”Ÿã‚€ã€‚","ã¬ãã‚‚ã‚Šã‚’æ·»ãˆã‚‹ã€‚"],
    c:["ç„¦ã‚‰ãšä»Šã‚’æ¥½ã—ã‚‚ã†ã€‚","äºˆå®šã®å…±æœ‰ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€‚","è¿”äº‹ã¯æ€¥ãŒãªãã¦OKã€‚","çŸ­ã„è¨€è‘‰ã§ååˆ†ä¼ã‚ã‚‹ã€‚","ç›¸æ‰‹ã®è‰¯ã„æ‰€ã‚’ä¸€ã¤è¦‹ã¤ã‘ã¦ã€‚","ç„¡ç†ã«ç››ã‚Šä¸Šã’ãªãã¦å¤§ä¸ˆå¤«ã€‚","ä¼šãˆãªãã¦ã‚‚å£°ã‚’å±Šã‘ã¦ã€‚","æ„Ÿè¬ã®è¨€è‘‰ã‚’å¿˜ã‚Œãšã«ã€‚","ä¸€ç·’ã«ç¬‘ãˆã‚‹è©±é¡Œã‚’ä¸€ã¤ã€‚","ä»Šæ—¥ã¯èƒŒä¼¸ã³ã—ãªã„ã§ã€‚","ä¸å®‰ã¯ãã®ã¾ã¾ã«ã›ãšç›¸è«‡ã‚’ã€‚","ä¼šã†ãªã‚‰æ˜¼ãŒå‰ã€‚","é¦™ã‚Šã‚„éŸ³æ¥½ã‚’å…±æœ‰ã™ã‚‹ã¨â—ã€‚","â€œã¾ãŸä»Šåº¦â€ã‚’å…·ä½“åŒ–ã—ã¦ã€‚","å†™çœŸã‚ˆã‚Šæ—¥å¸¸ã®ä¸€è¨€ã‚’ã€‚","ä¼šè©±ã¯è³ªå•ã§çµ‚ã‚ã‚‰ã›ãªã„ã€‚","ãŠé¡˜ã„ã”ã¨ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚","ã‚„ã•ã—ã„å¦å®šã§å¢ƒç•Œç·šã‚’ã€‚","æ·±è¿½ã„ã—ãªã„å‹‡æ°—ã‚‚æ„›æƒ…ã€‚","æ€ã„å‡ºè©±ã‚ˆã‚Šç¾çŠ¶ã‚’ã€‚"]},
  "ä»•äº‹":{a:["5åˆ†ã®ç²—æ¡ˆãŒ","ToDoä¸‰ã¤ã®å³é¸ãŒ","æœä¸€ã®é€£çµ¡ãŒ","æ®µå–ã‚Šã®è¦‹ç›´ã—ãŒ","å°ã•ãªè‡ªå‹•åŒ–ãŒ","éå»è³‡æ–™ã®å†åˆ©ç”¨ãŒ","ãƒ¡ãƒ¢ã¨ãƒã‚§ãƒƒã‚¯ãŒ","å ±é€£ç›¸ã®é€Ÿã•ãŒ","æœºã®æ•´ç†ãŒ","ä¼šè­°ã®çŸ­ç¸®ãŒ","å¯¾é¢ã§ã®ä¸€è¨€ãŒ","ä¼‘æ†©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒ","ç· åˆ‡ã‚’å‰å€’ã—ã«ã™ã‚‹ã“ã¨ãŒ","å‰æ—¥æº–å‚™ãŒ","æ‰‹æ›¸ãã‚¹ã‚±ãƒƒãƒãŒ","ä¾é ¼ã®å¾©å”±ãŒ","å„ªå…ˆé †ä½ã®å…±æœ‰ãŒ","è©¦ä½œå“ã¥ãã‚ŠãŒ","ä»®æ±ºã‚ãŒ","è¦‹ãˆã‚‹åŒ–ãŒ"],
    b:["æˆæœã‚’å¼•ãä¸Šã’ã‚‹ã€‚","é›†ä¸­ã‚’é•·æŒã¡ã•ã›ã‚‹ã€‚","é€²æ—ã‚’åŠ é€Ÿã™ã‚‹ã€‚","ãƒŸã‚¹ã‚’æ¸›ã‚‰ã™ã€‚","è©•ä¾¡ã«ã¤ãªãŒã‚‹ã€‚","æ™‚é–“ã‚’ç”Ÿã‚€ã€‚","å®‰å¿ƒã‚’ç”Ÿã‚€ã€‚","ãƒãƒ¼ãƒ ã‚’å¼·ãã™ã‚‹ã€‚","é ­ã‚‚æ•´ãˆã‚‹ã€‚","æ„æ€æ±ºå®šã‚’é€Ÿãã™ã‚‹ã€‚","ç©ºæ°—ã‚’å¤‰ãˆã‚‹ã€‚","åŠ¹ç‡ã‚’ä¸Šã’ã‚‹ã€‚","ãƒˆãƒ©ãƒ–ãƒ«ã‚’é¿ã‘ã‚‹ã€‚","æ‰‹æˆ»ã‚Šã‚’é˜²ãã€‚","ç™ºæƒ³ã‚’åºƒã’ã‚‹ã€‚","èª¤è§£ã‚’ãªãã™ã€‚","è¶³ä¸¦ã¿ã‚’æƒãˆã‚‹ã€‚","å½¢ã«è¿‘ã¥ã‘ã‚‹ã€‚","å‰ã«é€²ã‚ã‚‹ã€‚","å…±æœ‰ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã™ã‚‹ã€‚"],
    c:["åˆå‰ã«é‡ã„ä»•äº‹ã‚’ç‰‡ã¥ã‘ã‚ˆã†ã€‚","ãƒ¡ãƒ¼ãƒ«ã¯çŸ­ãçµè«–ã‹ã‚‰ã€‚","ä¼šè©±ã¯â€œä¾é ¼â†’æœŸé™â†’å½¢å¼â€ã§ã€‚","ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½¿ãŠã†ã€‚","é›†ä¸­ã‚¿ã‚¤ãƒ ã¯é€šçŸ¥ã‚ªãƒ•ã§ã€‚","ä»Šæ—¥ã®æˆåŠŸã¯æ•°æ—¥å¾Œã«åŠ¹ã„ã¦ãã‚‹ã€‚","è¿·ã£ãŸã‚‰ä¸Šå¸ã«ç›¸è«‡ã‚’ã€‚","è³‡æ–™ã¯ä¸€æšã«è¦ç´„ã™ã‚‹æ„è­˜ã§ã€‚","å¸­ã‚’ç«‹ã£ã¦æ­©ãã¨ç™ºæƒ³ãŒå‡ºã‚‹ã€‚","ä¼šè­°ã¯30åˆ†ä»¥å†…ã‚’ç›®æŒ‡ãã†ã€‚","æ•°å­—ã¯äºŒäººã§ç¢ºèªãŒå®‰å…¨ã€‚","ç–²ã‚ŒãŸã‚‰æ·±å‘¼å¸ã§ãƒªã‚»ãƒƒãƒˆã€‚","ãƒ‰ãƒ©ãƒ•ãƒˆã§è‰¯ã„ã‹ã‚‰å…ˆã«å‡ºã™ã€‚","â€œã‚„ã‚‰ãªã„ã“ã¨â€ã‚’æ±ºã‚ã‚ˆã†ã€‚","ç· åˆ‡å‰å€’ã—ã§å®‰å¿ƒã‚’ã¤ãã‚‹ã€‚","è¤‡é›‘ãªã“ã¨ã»ã©å›³ã«ã—ã¦å…±æœ‰ã€‚","ä»Šæ—¥ã®å­¦ã³ã‚’ä¸€è¡Œãƒ¡ãƒ¢ã«ã€‚","å°ã•ãªæ”¹å–„ã‚’ä¸€ã¤ã ã‘ã€‚","ã‚ã‚ŠãŒã¨ã†ã‚’å…ˆã«è¨€ãŠã†ã€‚","å®Œç’§ã‚ˆã‚Šç€æ‰‹ã‚’ã€‚"]},
  "é‡‘é‹":{a:["å›ºå®šè²»ã®è¦‹ç›´ã—ãŒ","è²¡å¸ƒã®æ•´ç†ãŒ","ãƒ¬ã‚·ãƒ¼ãƒˆã®æ’®å½±ãŒ","ãƒã‚¤ãƒ³ãƒˆã®ç¢ºèªãŒ","ãƒãƒƒãƒˆæ˜ç´°ã®ãƒã‚§ãƒƒã‚¯ãŒ","è²·ã„ç‰©ãƒ¡ãƒ¢ã®ä½œæˆãŒ","æ‰‹æ”¾ã™æº–å‚™ãŒ","å€¤æ®µæ¯”è¼ƒãŒ","åˆå‰ä¸­ã®æ”¯æ‰•ã„ãŒ","æ•°å­—ã®è¦‹ãˆã‚‹åŒ–ãŒ","å¯„ä»˜ã‚„ãŠç¤¼ãŒ","å®¶è¨ˆã‚¢ãƒ—ãƒªå…¥åŠ›ãŒ","ã‚µãƒ–ã‚¹ã‚¯ç‚¹æ¤œãŒ","å†·è”µåº«åœ¨åº«ã®ç¢ºèªãŒ","ãŠå¾—æƒ…å ±ã®åé›†ãŒ","ç¾é‡‘ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹ã®ä½¿ã„åˆ†ã‘ãŒ","æ¬²ã—ã„ç‰©ã®â€œä¿ç•™â€ãŒ","ä¸­å¤ãƒ»ãƒªãƒ¦ãƒ¼ã‚¹ã®æ¤œè¨ãŒ","ä¿®ç†ã¨è²·ã„æ›¿ãˆã®åˆ¤æ–­ãŒ","å°éŠ­è²¯é‡‘ã®ç¶™ç¶šãŒ"],
    b:["ç„¡é§„ã‚’æ¸›ã‚‰ã™ã€‚","å®‰å¿ƒã«ã¤ãªãŒã‚‹ã€‚","ç®¡ç†ã‚’æ¥½ã«ã™ã‚‹ã€‚","å¾—ã‚’ç”Ÿã‚€ã€‚","å¤±å¿µã‚’é˜²ãã€‚","è¡å‹•è²·ã„ã‚’æŠ‘ãˆã‚‹ã€‚","é‡‘é‹ã‚’å·¡ã‚‰ã›ã‚‹ã€‚","ç´å¾—æ„Ÿã‚’é«˜ã‚ã‚‹ã€‚","å¿ƒé…ã‚’æ¸›ã‚‰ã™ã€‚","åˆ¤æ–­ã‚’åŠ©ã‘ã‚‹ã€‚","è‰¯ã„å¾ªç’°ã‚’ä½œã‚‹ã€‚","è¦‹é€šã—ã‚’è‰¯ãã™ã‚‹ã€‚","æ¼ã‚Œã‚’é˜²ãã€‚","ç„¡é§„è²·ã„ã‚’é˜²ãã€‚","æ˜ã‚Šå‡ºã—ç‰©ã«å‡ºä¼šã†ã€‚","æ”¯å‡ºã®è³ªã‚’ä¸Šã’ã‚‹ã€‚","å†·é™ã•ã‚’ä¿ã¤ã€‚","æ‰‹å…ƒè³‡é‡‘ã‚’å®ˆã‚‹ã€‚","é•·æŒã¡ã«ç¹‹ãŒã‚‹ã€‚","ç©ã¿ä¸Šã’ã«ãªã‚‹ã€‚"],
    c:["ä»Šæ—¥ã¯â€œè²·ã†å‰ã«ä¸€æ™©ç½®ãâ€ã€‚","æ¬²ã—ã„ç‰©ã¯â€œç”¨é€”â†’é »åº¦â†’ä¿ç®¡â€ã§è€ƒãˆã‚ˆã†ã€‚","ãƒã‚¤ãƒ³ãƒˆã¯æœŸé™ãƒã‚§ãƒƒã‚¯ã‚’ã€‚","æ”¯æ‰•ã„ã¯åˆå‰ã«æ¸ˆã¾ã›ã¦ã‚¹ãƒƒã‚­ãƒªã€‚","å‰²å¼•ã‚ˆã‚Šâ€œå¿…è¦ã‹â€ã‚’åŸºæº–ã«ã€‚","ã‚®ãƒ•ãƒˆã‚„ãŠç¤¼ã«ã¯æƒœã—ã¾ãªã„ã§ã€‚","å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒªã«3åˆ†å…¥åŠ›ã€‚","ã‚µãƒ–ã‚¹ã‚¯ã¯ä¸€ä»¶ã ã‘è§£ç´„ã‚’æ¤œè¨ã€‚","è²·ã„ç‰©ã¯ãƒ¡ãƒ¢ã«æ²¿ã£ã¦ã€‚","è‡¨æ™‚åå…¥ã¯è²¯è“„ã¨çµŒé¨“ã«åŠåˆ†ãšã¤ã€‚","é‡‘é‹ã¯â€œæ•´é “â€ã‹ã‚‰å§‹ã¾ã‚‹ã€‚","ä»Šæ—¥ã¯è¦‹æ „ã‚ˆã‚Šå®Ÿç”¨ã€‚","ä¸­å¤å¸‚å ´ã‚’è¦—ãã¨è‰¯ã„ç™ºè¦‹ã€‚","ä¸è¦å“ã¯ãƒ•ãƒªãƒã¸ã€‚","å€¤æ®µã‚ˆã‚Šâ€œå¯¿å‘½â€ã§åˆ¤æ–­ã€‚","å¥‘ç´„ã¯å°ã•ãªæ–‡å­—ã¾ã§ç¢ºèªã‚’ã€‚","ç¾é‡‘ã®æŒã¡ã™ãæ³¨æ„ã€‚","å°éŠ­ã¯è²¯é‡‘ç®±ã«ç§»å‹•ã€‚","å¤–é£Ÿã¯ä¸€å›ã ã‘ã«ã€‚","æ„Ÿè¬ã¨ã¨ã‚‚ã«ãŠé‡‘ã‚’å·¡ã‚‰ã›ã‚ˆã†ã€‚"]},
  "å¥åº·":{a:["å§¿å‹¢ãƒªã‚»ãƒƒãƒˆã§","ç™½æ¹¯ã¾ãŸã¯å¸¸æ¸©æ°´ã§","æ­©æ•°ã‚’å°‘ã—å¢—ã‚„ã™ã¨","è»½ã„ã‚¹ãƒˆãƒ¬ãƒƒãƒã§","å°±å¯å‰ã«ã‚¹ãƒãƒ›ã‚’é›¢ã—ã¦","ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’æ„è­˜ã—ã¦","å¤–ã®ç©ºæ°—ã«è§¦ã‚Œã¦","çŸ­ã„å°ä¼‘æ­¢ã§","é¢¨å‘‚ä¸ŠãŒã‚Šã®æ°´åˆ†è£œçµ¦ã§","æ¹¯èˆ¹ã«æµ¸ã‹ã£ã¦","è‚©ã¨é¦–ã‚’å›ã—ã¦","ã‚¹ãƒˆãƒ¬ãƒƒãƒ5åˆ†ã§","é£Ÿå¾Œã®è»½ã„æ•£æ­©ã§","å‘¼å¸ã‚’æ•´ãˆã¦","å¯ã‚‹å‰ã®æ·±å‘¼å¸ã§","ä½“ã‚’æ¸©ã‚ã‚‹é£Ÿäº‹ã§","å†·ãŸã„é£²ã¿ç‰©ã‚’é¿ã‘ã¦","æ—¥å…‰ã‚’æµ´ã³ã¦","å¡©é¢¨å‘‚ã§","è¶³é¦–ã‚’æ¸©ã‚ã¦","ãŠè…¹ã¨èƒŒä¸­ã‚’å®ˆã£ã¦","æ—©å¯æ—©èµ·ãã§","ãƒ„ãƒœæŠ¼ã—ã§","ä½“ã‚’å‹•ã‹ã—ã¦","æœºã®é«˜ã•èª¿æ•´ã§","ç”˜ã„ã‚‚ã®ã¯åˆå‰ã«ã—ã¦","ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã‚’æ§ãˆã¦","çŸ­æ™‚é–“é‹å‹•ã§ã‚‚ç¶šã‘ã¦","æ—¬ã®é£Ÿæã§","å§¿å‹¢ã‚’ä¼¸ã°ã—ã¦","åŠ æ¹¿ã¨ä¿æ¸©ã§","ç„¡ç†ã›ãšä¼‘æ¯ã‚’ã¨ã‚Š","ç›®ã‚’ä¼‘ã‚ã¦é ãã‚’è¦‹ã¦","è’¸ã—ã‚¿ã‚ªãƒ«ã§æ¸©ã‚ã¦","æœã®ç™½æ¹¯ã§","æ°´ã‚’é£²ã‚€ãŸã³æ·±å‘¼å¸ã§","è¡£æœèª¿æ•´ã‚’æ„è­˜ã—ã¦","æ—©ã‚ã®ã‚±ã‚¢ã§","ã‚ˆãç¬‘ã£ã¦"],
    b:["é›†ä¸­ãŒæˆ»ã‚‹ã€‚","ä»£è¬ãŒæ•´ã†ã€‚","ä½“ãŒè»½ããªã‚‹ã€‚","è¡€æµãŒè‰¯ããªã‚‹ã€‚","ç¡çœ ã®è³ªãŒä¸ŠãŒã‚‹ã€‚","å®‰å®šã™ã‚‹ã€‚","æ°—åˆ†ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã€‚","è„³ãŒä¼‘ã¾ã‚‹ã€‚","è„±æ°´ã‚’é˜²ã’ã‚‹ã€‚","ç–²åŠ´å›å¾©ãŒé€²ã‚€ã€‚","è‚©ã“ã‚Šå¯¾ç­–ã«ã€‚","å®‰çœ ã«è¿‘ã¥ãã€‚","æ¶ˆåŒ–ã‚’åŠ©ã‘ã‚‹ã€‚","å¿ƒæ‹ãŒè½ã¡ç€ãã€‚","ä¸€æ—¥ã®ç–²ã‚Œã‚’æ‰‹æ”¾ã›ã‚‹ã€‚","ä½“æ¸©ãŒä¿ã¦ã‚‹ã€‚","ãƒªã‚ºãƒ ãŒæ•´ã†ã€‚","ãƒ¡ãƒ³ã‚¿ãƒ«ãŒä¸Šå‘ãã€‚","ãƒªãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœâ—ã€‚","å…¨èº«ãŒã»ãã‚Œã‚‹ã€‚","å†·ãˆå¯¾ç­–ã«ã€‚","ä½“å†…æ™‚è¨ˆãŒæ•´ã†ã€‚","ã‚³ãƒªãŒå’Œã‚‰ãã€‚","æ°—æŒã¡ã‚‚æ•´ã†ã€‚","è² æ‹…ãŒæ¸›ã‚‹ã€‚","è¡€ç³–å€¤ã®æ€¥ä¸Šæ˜‡ã‚’æŠ‘ãˆã‚‹ã€‚","ç¡çœ ã‚’é‚ªé­”ã—ãªã„ã€‚","æˆæœãŒè¦‹ãˆã‚‹ã€‚","è‡ªç„¶ã¨æ•´ã†ã€‚","å‘¼å¸ãŒæ·±ããªã‚‹ã€‚","ä¹¾ç‡¥å¯¾ç­–ã«ã€‚","ä½“åŠ›æ¸©å­˜ã«ã€‚","ç›®ã®è² æ‹…è»½æ¸›ã«ã€‚","å·¡ã‚ŠãŒè‰¯ããªã‚‹ã€‚","ä»£è¬ã‚¢ãƒƒãƒ—ã«ã€‚","æ„è­˜ãŒæ•´ã†ã€‚","ä½“èª¿ã‚’å´©ã—ã«ãã„ã€‚","ä¸èª¿ã®èŠ½ã‚’æ‘˜ã‚ã‚‹ã€‚","å…ç–«ãŒä¸ŠãŒã‚‹ã€‚"],
    c:["ä»Šæ—¥ã¯â€œé ‘å¼µã‚Šã™ããªã„â€ãŒéµã€‚","ç„¡ç†ã®ãªã„ç¯„å›²ã§OKã€‚","ã“ã¾ã‚ã«æ°´åˆ†ã‚’ã€‚","1æ™‚é–“ã«ä¸€åº¦ã¯ç«‹ã¡ä¸ŠãŒã‚ã†ã€‚","å…¥æµ´å¾Œã®ä¿æ¹¿ã‚‚å¿˜ã‚Œãšã«ã€‚","æ·±å‘¼å¸ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€‚","å°ã•ãªç©ã¿é‡ã­ã§ååˆ†ã€‚","ä½“ã‚’æ¸©ã‚ã‚‹é£Ÿæã‚’é¸ã‚“ã§ã€‚","å°‘ã—æ—©ã‚ã«ä¼‘ã‚‚ã†ã€‚","ç›®ã‚’é–‰ã˜ã¦30ç§’ã®ä¼‘æ¯ã‚’ã€‚","ã‚¹ãƒˆãƒ¬ãƒƒãƒã¯åå‹•ã‚’ã¤ã‘ãªã„ã“ã¨ã€‚","ä»Šæ—¥ã¯â€œèƒŒä¸­â€ã‚’åŠ´ã‚ã£ã¦ã€‚","å‘³å™Œæ±ã‚„ã‚¹ãƒ¼ãƒ—ã‚’æ·»ãˆã¦ã€‚","äººæ··ã¿ã§ã¯ãƒã‚¹ã‚¯ã‚‚é¸æŠè‚¢ã€‚","é´ã‚’å±¥ãæ›¿ãˆã‚‹ã¨æ­©ãã‚„ã™ã„ã€‚","ä½“èª¿ãŒä¹±ã‚ŒãŸã‚‰äºˆå®šã‚’è»½ãã—ã¦ã€‚","ç¬‘ã†ã“ã¨ã‚’æ„è­˜ã—ã¦ã€‚","ã‚†ã£ãã‚Šé£Ÿã¹ã‚ˆã†ã€‚","ä½œæ¥­ã®åˆé–“ã«è‚©ã‚’å›ãã†ã€‚","å¯å®¤ã‚’å°‘ã—æš—ãã—ã¦ã€‚"]}
};

// --- é«˜åº¦ç‰ˆï¼ša/bè¢«ã‚Šå›é¿ + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é‡è¤‡ç‡å›é¿ ---
function extractKeywordsJP(text){
  const raw = (text || "")
    .replace(/[0-9ï¼-ï¼™]/g, "")
    .match(/[ä¸€-é¾ ã€…ã€†ãƒµãƒ¶ã-ã‚“ã‚¡-ãƒ´ãƒ¼]{2,}/g) || [];

  const stop = new Set([
    "ä»Šæ—¥","å°‘ã—","ä¸€ã¤","ã¾ãŸ","ã‚ˆã†","ãŸã‚","ç„¡ç†","å¤§äº‹","å¤§ä¸ˆå¤«",
    "æ°—æŒã¡","è‡ªåˆ†","ç›¸æ‰‹","æ™‚é–“","æ„Ÿã˜","æ„è­˜","è‰¯ã„","å¤§åˆ‡","å¿…è¦"
  ]);

  return raw.filter(w => !stop.has(w));
}

function keywordOverlapRate(line1, line2){
  const k1 = new Set(extractKeywordsJP(line1));
  const k2 = new Set(extractKeywordsJP(line2));
  if(k1.size === 0 && k2.size === 0) return 0;

  let inter = 0;
  for(const w of k1) if(k2.has(w)) inter++;

  const uni = k1.size + k2.size - inter;
  return uni === 0 ? 0 : inter / uni;
}

function composePartsWithRng(topic, rng){
  const bank = BANK[topic];
  if(!bank) return { line:"", a:"", b:"", c:"" };

  const a = bank.a[Math.floor(rng()*bank.a.length)];
  const b = bank.b[Math.floor(rng()*bank.b.length)];
  const c = bank.c[Math.floor(rng()*bank.c.length)];
  return { line:`${a}${b}${c}`, a, b, c };
}

function composeLineWithRng(topic, rng, avoidA=null, avoidB=null, avoidLine=null, maxOverlap=0.35){
  const bank = BANK[topic];
  if(!bank) return { line:"", a:"", b:"", c:"" };

  let guard = 0;
  let p = composePartsWithRng(topic, rng);

  while(guard < 12){
    const aOK = (avoidA === null) || (p.a !== avoidA);
    const bOK = (avoidB === null) || (p.b !== avoidB);
    const lineOK = (avoidLine === null) || (p.line !== avoidLine);
    const overlapOK = (avoidLine === null) || (keywordOverlapRate(p.line, avoidLine) <= maxOverlap);

    if(aOK && bOK && lineOK && overlapOK) break;

    p = composePartsWithRng(topic, rng);
    guard++;
  }

  return p;
}

function uniqueTwoLines(topic, seedStr){
  const rng1 = makeRng(stableSeed(seedStr+'|1'));
  const rng2 = makeRng(stableSeed(seedStr+'|2'));
  const rng3 = makeRng(stableSeed(seedStr+'|3'));

  const p1 = composeLineWithRng(topic, rng1);

  let p2 = composeLineWithRng(topic, rng2, p1.a, p1.b, p1.line, 0.35);

  if(keywordOverlapRate(p1.line, p2.line) > 0.35){
    p2 = composeLineWithRng(topic, rng3, p1.a, p1.b, p1.line, 0.30);
  }

  if(p2.line === p1.line){
    p2.line = p2.line.replace('ã€‚','ï¼');
    if(p2.line === p1.line){
      p2.line = 'ä»Šã¯â€œä¸å¯§ã«ä¸€æ­©â€ã€‚ç„¡ç†ãªãé€²ã‚ã°ååˆ†ã€‚';
    }
  }

  return [p1.line, p2.line];
}


async function runHoroscope(){
  saveInputs();
  const birth=$('birthDate').value; if(!birth){alert('ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');return;}
  const latStr=(($('lat').value||'').trim()||'0'); const lonStr=(($('lon').value||'').trim()||'0');
  const lat=parseFloat(latStr), lon=parseFloat(lonStr); if(isNaN(lat)||isNaN(lon)){alert('ç·¯åº¦çµŒåº¦ãŒç„¡åŠ¹ã§ã™ã€‚');return;}
  const tDate=$('targetDate')?.value||''; const dateStr=tDate?tDate:new Date().toISOString().split('T')[0];
  const place=($('placeName').value||'').trim();

  const seedStr=['v52-2',birth,dateStr,place.toLowerCase(),
    Number.isFinite(lat)?lat.toFixed(4):'0.0000',
    Number.isFinite(lon)?lon.toFixed(4):'0.0000'].join('|');
  const baseSeed = stableSeed(seedStr);
  const rng = makeRng(baseSeed);

  // Local-safe birthday detection (avoid UTC parsing issues)
const [by,bm,bd2] = (birth||'').split('-').map(v=>parseInt(v,10));
const [ty,tm,td] = (dateStr||'').split('-').map(v=>parseInt(v,10));
const today = new Date();

// æŒ‡å®šæ—¥ã®å ã„ãŒèª•ç”Ÿæ—¥ã‹ï¼ˆUIä¸Šã®å¼·èª¿ã«ä½¿ç”¨ã€ç´™å¹é›ªã¯ä½¿ã‚ãªã„ï¼‰
const isBirthday = (tm === bm && td === bd2);

// ä»Šæ—¥ãŒèª•ç”Ÿæ—¥ã‹ï¼ˆç´™å¹é›ªã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒªã‚¬ãƒ¼ï¼‰
const isTodayBirthday = ((today.getMonth()+1) === bm && today.getDate() === bd2);

  const ctx={}; ctx.seasonNews=await fetchNewsAndSeasonContext(dateStr);

  // --- Multi-planet angle-only engine ---
  const dForAngle = new Date(dateStr+'T12:00:00');
  const jd = toJD(dForAngle);
  const sunLon   = sunLongitudeDeg(jd);
  const moonLon  = moonLongitudeDeg(jd);
  const mercLon  = planetLongitudeDeg(jd, "Mercury");
  const venusLon = planetLongitudeDeg(jd, "Venus");
  const marsLon  = planetLongitudeDeg(jd, "Mars");
  const jupLon   = planetLongitudeDeg(jd, "Jupiter");
  const satLon   = planetLongitudeDeg(jd, "Saturn");

  const planets = [
    { name:"Sun",     lonDeg:sunLon,   weight:1.0 },
    { name:"Moon",    lonDeg:moonLon,  weight:1.0 },
    { name:"Mercury", lonDeg:mercLon,  weight:0.6 },
    { name:"Venus",   lonDeg:venusLon, weight:0.8 },
    { name:"Mars",    lonDeg:marsLon,  weight:0.8 },
    { name:"Jupiter", lonDeg:jupLon,   weight:0.7 },
    { name:"Saturn",  lonDeg:satLon,   weight:0.7 }
  ];

  const angleResult = computeAngleOnlyScore(planets);
  const base = angleResult.score;

  // æ˜Ÿã®è§’åº¦ã®ç°¡å˜ãªè§£èª¬ï¼ˆç·åˆã‚¹ã‚³ã‚¢ï¼‹èª¿å’Œ/ç·Šå¼µï¼‰
  const tone =
    angleResult.globalPower > 0.35 ? "èª¿å’Œå„ªå‹¢" :
    angleResult.globalPower < -0.35 ? "ç·Šå¼µå„ªå‹¢" : "ä¸­åº¸";

  const starDetail =
    `â˜† æ˜Ÿã®è§’åº¦ï¼ˆå¤©ä½“ç·åˆï¼‰ï¼š${angleResult.score}%ï¼ˆ${tone}ï¼èª¿å’Œ${angleResult.harmonyScore}ãƒ»ç·Šå¼µ${angleResult.tensionScore}ï¼‰`;

  ctx.seasonNews += `<br><span class="muted">${starDetail}</span>`;

  const topics=['å…¨ä½“é‹','æ‹æ„›','ä»•äº‹','é‡‘é‹','å¥åº·'];
  const perTopic=2;

  let html=`<div class="muted">${ctx.seasonNews}</div>`;
  for(const t of topics){
    const jitter = Math.floor(rng()*7)-3;
    const tweak  = TOPIC_TWEAK[t]||0;
    let pct = Math.round(Math.max(1, Math.min(98, base + jitter + tweak + (isBirthday?5:0))));

    const topicSeed = stableSeed(seedStr+'|'+t);
    const trng = makeRng(topicSeed);
    const [l1, l2] = uniqueTwoLines(t, seedStr+'|'+t);

    html+=`<div class="card">
      <div class="row">
        <div class="title">${t}</div>
        <div class="score"><div class="bar"><div class="bar-fill" style="width:${pct}%;"></div></div><span class="pct">${pct}%</span></div>
      </div>
      ${'â€¢ '+escapeHtml(l1)}<br>${'â€¢ '+escapeHtml(l2)}
    </div>`;
  }
  if(isBirthday){
    html+=`<div class="card birthday"><strong>ğŸ‚ ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</strong><br>ã™ã¦ããªä¸€å¹´ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ã€‚</div>`;
  }

  $('resultContainer').innerHTML=html;
  $('inputArea').style.display='none'; $('outputArea').style.display='block';

  if(isTodayBirthday){ requestAnimationFrame(()=>requestAnimationFrame(()=>triggerConfetti(5500,90))); }
}

function triggerConfetti(durationMs=5000,count=80){
  const cvs=$('confettiCanvas'); if(!cvs) return; const ctx=cvs.getContext('2d');
  const DPR=Math.max(1,Math.floor(window.devicePixelRatio||1));
  function resize(){cvs.style.display='block'; cvs.width=innerWidth*DPR; cvs.height=innerHeight*DPR;} resize();
  const colors=['#6b46c1','#b794f4','#ffd166','#ffffff','#ff6b6b']; const pcs=[];
  for(let i=0;i<count;i++){pcs.push({x:Math.random()*cvs.width,y:-Math.random()*cvs.height*0.5,w:(6+Math.random()*8)*DPR,h:(3+Math.random()*5)*DPR,vx:(Math.random()*2-1)*0.6*DPR,vy:(1.2+Math.random()*2.0)*DPR,rot:Math.random()*Math.PI,vr:(Math.random()*2-1)*0.1,color:colors[i%colors.length],alpha:1});}
  const start=performance.now();
  function step(t){const e=t-start; ctx.clearRect(0,0,cvs.width,cvs.height);
    const fade=Math.min(1,Math.max(0,(e-durationMs*0.7)/(durationMs*0.3)));
    for(const p of pcs){p.x+=p.vx+Math.sin((p.y+e*0.002))*0.4*DPR; p.y+=p.vy; p.rot+=p.vr; p.alpha=Math.max(0,1-fade);
      ctx.save(); ctx.globalAlpha=p.alpha; ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
      if(p.y>cvs.height+40*DPR){p.y=-20*DPR;}
    }
    if(e<durationMs) requestAnimationFrame(step); else {ctx.clearRect(0,0,cvs.width,cvs.height); cvs.style.display='none';}
  }
  requestAnimationFrame(step);
}

function backToInput(){
  const cvs = document.getElementById('confettiCanvas');
  if (cvs) {
    const ctx = cvs.getContext('2d');
    try { ctx && ctx.clearRect(0,0,cvs.width,cvs.height); } catch(_){}
    cvs.style.display='none';
  }
  document.getElementById('outputArea').style.display='none';
  document.getElementById('inputArea').style.display='block';
  window.scrollTo({top:0,left:0,behavior:'instant'});
  setTimeout(()=>{ document.getElementById('birthDate')?.focus(); }, 0);
}

async function onGeocodeClick(){
  const q=($('placeName').value||'').trim();
  if(!q){alert('éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');return;}
  const alias=snapToPresetIfAlias(q);
  if(alias){$('lat').value=alias.lat;$('lon').value=alias.lon;saveInputs();toast(`${q} ã‚’æ±äº¬ã®ä»£è¡¨ç‚¹ã«å›ºå®šã—ã¾ã—ãŸ`);return;}
  try{
    toast('ä½ç½®æ¤œç´¢ä¸­â€¦');
    const url='https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURIComponent(q);
    const r=await fetch(url,{headers:{'Accept':'application/json'}}); if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json(); if(!j||!j.length){alert('è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚'); return;}
    let lat=String(j[0].lat), lon=String(j[0].lon); const near=snapNearPreset(lat,lon,15); if(near){lat=near.lat;lon=near.lon;}
    $('lat').value=lat; $('lon').value=lon; saveInputs(); toast('åº§æ¨™ã‚’è¨­å®šã—ã¾ã—ãŸ');
  }catch(e){ alert('ä½ç½®å–å¾—ã«å¤±æ•—: '+(e.message||e)); }
}

let _h2c=null;
function loadHtml2Canvas(){ if(_h2c) return _h2c; _h2c=new Promise((ok,ng)=>{const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js'; s.onload=()=>ok(); s.onerror=()=>ng(new Error('html2canvas load error')); document.head.appendChild(s);}); return _h2c; }
function ts(){const d=new Date(); const p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}_${p(d.getHours())}${p(d.getMinutes())}`;}
async function saveAsJPEG(){
  try{
    await loadHtml2Canvas();
    const node=$('resultContainer');
    const canvas=await html2canvas(node,{backgroundColor:'#ffffff',scale:2});
    const url=canvas.toDataURL('image/jpeg',0.92);
    const a=document.createElement('a'); a.href=url;
    const bd=$('birthDate').value||'unknown'; const bt=($('birthTime').value||'00:00').replace(':','-');
    const t=$('targetDate')?.value||''; const tag=t?('_'+t):'';
    a.download=`horoscope_${ts()}${tag}_${bd}_${bt}.jpg`;
    a.click(); toast('JPEGã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  }catch(e){ alert('ä¿å­˜ã«å¤±æ•—: '+(e.message||e)); }
}

function wireBack(){
  const b = document.getElementById('backBtn');
  const goBack = (e)=>{ e?.preventDefault?.(); backToInput(); };
  ['click','touchend'].forEach(ev=> b.addEventListener(ev, goBack, {passive:true}));
  window.addEventListener('keydown', (e)=>{
    if (document.getElementById('outputArea').style.display==='block') {
      if (e.key === 'Escape') goBack(e);
      if (e.key === 'Enter' && (e.target===b)) goBack(e);
    }
  });
}

function init(){
  loadInputs();
  $('geoBtn').addEventListener('click', onGeocodeClick);
  $('runBtn').addEventListener('click', runHoroscope);
  $('backBtn').addEventListener('click', backToInput);
  wireBack();
  $('saveBtn').addEventListener('click', saveAsJPEG);
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/horoscope-100pct-2/sw.js?v=52-2', { scope: '/horoscope-100pct-2/' })
      .catch(console.error);
  }
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
